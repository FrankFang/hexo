---
layout: post
tag: 编程
title: JavaScript 中的变量声明
---

JS 中怎么声明变量？[Douglas Crockford][1] 在 2011 年的[一次演讲][2]中的观点是：
> 鉴于 JS 「只有 function scope 而没有 block scope」和「声明提升（Hoisting）」两个特点，我们应该在函数体的最开始声明所有变量。

阮一峰[对这个观点的解读][3]是：
> 既然 JS 解释器会自动把变量的声明提升到函数体的最开始，我们还不如自己把变量声明写在函数的最开始。

阮一峰的解读并不能说服我，因为既然解释器会帮我们提升变量，那为什么我还要亲自去做这件事呢？

我的想法是，把变量全在写在函数的最开始，在逻辑上是没有问题的，但是实际开发中会遇到这样一个麻烦：我已经写到这个函数的第50行了（假设屏幕的高度只能容纳45行代码），那么这个时候我要声明一个变量的话，还是要把它写到函数最开始吗？那就意味着我必须滚动屏幕，然后在声明语句的最后添加新的声明。

这个操作真的令我觉得很麻烦。

如果我不想麻烦，其实我还有两条路可走：

1. 一个函数超过的50行，说明重构的空间很大，拆成两个函数，这样就不存在滚动屏幕才能添加的一个变量声明的尴尬了。
2. 抛弃 Douglas 的建议，采用「就近声明」的方法。

目前我采用的是第二条路，但着实遇到了不少问题，比如

	if (flag){
	    var foo = 1;
	}else{
	    // ...
	}

 在写这样的代码的时候，我经常忘了 foo 是可以在 if 之外被访问到的。

 所以我现在决定还是在用 Douglas 大神的建议。

 读者你可能会说，你真搞笑，说了这么多这不相当于没说么，你不还是用了 Douglas 的建议吗？你一开始就直接听从大神的指导意见不就好了吗？

 是的，听从大神的意见往往是不错的，但我得知其所以然，你说是不，所谓不吃一堑不长一智。

 就算决定了把变量都放在开头，我依然面临一个选择：我该用一个 var 还是用多个 var 呢？

	var a = 1,
	    b = 2,
	    c = 3;
	
	var a = 1;
	var b = 2;
	var c = 3;

我想我会选择后者，理由是便于修改。如果我采用了前者，那么每次我要添加或删除一个变量时，总是要考虑几个问题：

1. 这一行应该以逗号结尾还是以分号结尾
2. 我是否需要把上一行的分号改为逗号

而采用后者的话，只需要添加或删除行就行了，不需要选择分号还是逗号。（其实这些分号是可以省略的）

所以我的结论是：

1. 变量声明都放在函数开头。
2. 使用多个 var

至于要不要加分号，又可以另起一篇文章了，知乎上就有[一篇相关的讨论][4]。


[1]:http://en.wikipedia.org/wiki/Douglas_Crockford
[2]:http://ontwik.com/javascript/douglas-crockford-javascript-programming-style-and-your-brain/
[3]:http://www.ruanyifeng.com/blog/2012/04/javascript_programming_style.html
[4]:http://www.zhihu.com/question/20298345
